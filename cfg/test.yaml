###########################################################
#                                                         #
# Copyright (c)                                           #
#                                                         #
# The Verifiable & Control-Theoretic Robotics (VECTR) Lab #
# University of California, Los Angeles                   #
#                                                         #
# Authors: Kenny J. Chen, Ryan Nemiroff, Brett T. Lopez   #
# Contact: {kennyjchen, ryguyn, btlopez}@ucla.edu         #
#                                                         #
###########################################################

dlio:
  version: piluohong
  loopflag: true
  saveFile: false
  matchMethod: VGICP
  
  adaptive: true

  pointcloud:
    deskew: true
    voxelize: true

  imu:
    calibration: true
    intrinsics:
      accel:
        # bias: [ 6.4356659353532566e-05, 6.4356659353532566e-05, 6.4356659353532566e-05]
        bias: [0.,0.,0.]
        sm:   [ 1.,  0.,  0.,
                0.,  1.,  0.,
                0.,  0.,  1. ]
      gyro:
        bias:  [ 0.001,  0.001,  0.001 ]

  extrinsics:
    baselink2imu:
      t: [ -0.006730146149038548, -0.006897049862999071,0.049898628062256645 ]
      R: [ 0.006609639848469365, -0.9999773650294649, 0.0012578115132016717,
          -0.9999762249571927, -0.006612093869054189, -0.0019569708811106104,
          0.001965243352927244, -0.0012448467359610184, -0.9999972940839232 ]
      # t: [0.0,0.0,0.0]
      # R: [1, 0, 0,
      #       0, 1, 0,
      #       0, 0, 1]
    baselink2lidar:
      t: [ 0.,  0.,  0. ]
      R: [ 1.,  0.,  0.,
           0.,  1.,  0.,
           0.,  0.,  1. ]
      # R: [0, -1, 0,
      #     1, 0, 0,
      #     0, 0, 1]

  frames:
    odom: map
    baselink: base_link
    lidar: lidar
    imu: imu

  map:
    waitUntilMove: false
    dense:
      filtered: true
    sparse:
      frequency: 1.0
      leafSize: 0.25

  odom:

    gravity: 9.8065

    imu:
      approximateGravity: false
      calibration:
        gyro: true
        accel: true
        time: 4
      bufferSize: 5000

    preprocessing:
      cropBoxFilter:
        size: 1.0
      voxelFilter:
        res: 0.25

    keyframe:
      threshD: 0.5
      threshR: 30.0
      threshJaccardCorr: 2.0 
      threshJaccardSim: 0.1
      envir_thresh_: 2.0
      #LOOP
      loop_score_: 0.3
      loop_search_R: 20
      loop_search_Num: 20
      loop_size: 0.2
      loop_frequeency: 2
      downsamplerate: 1.0

    submap:
      keyframe:
        knn: 20
        kcv: 5
        kcc: 5
    gicp:
      minNumPoints: 1000
      kCorrespondences: 20 #20
      maxCorrespondenceDistance: 1.0 #0.5
      maxIterations: 72
      transformationEpsilon: 0.01
      rotationEpsilon: 0.01
      initLambdaFactor: 1e-9 #优化步长
      neighborSearch: 1
      dw_dist: 0.00
      dw_azimuth: 0.00
      dw_elevation: 0.00

    geo:
      Kp: 4.5
      Kv: 11.25
      Kq: 4.0
      Kab: 2.25
      Kgb: 1.0
      abias_max: 5.0
      gbias_max: 0.5
